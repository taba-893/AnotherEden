<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ‰€æŒã‚­ãƒ£ãƒ©ãƒã‚§ãƒƒã‚«ãƒ¼ï½œç”»åƒå¯¾å¿œç‰ˆ</title>
  <!--
    â–¼ä½¿ã„æ–¹
    1) ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ checker.html ã¨ã—ã¦ä¿å­˜ï¼ˆãƒªãƒã‚¸ãƒˆãƒªç›´ä¸‹ï¼‰
    2) /images ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚Šã€ aldo.png ãªã©ã®ã‚­ãƒ£ãƒ©ç”»åƒã‚’é…ç½®
       ä¾‹: /images/aldo.png, /images/iwera.png ...
    3) CHARACTERS é…åˆ—ã® img ã«ç”»åƒãƒ‘ã‚¹ã‚’è¨­å®š (ä¾‹: "./images/aldo.png")
    4) index.html ã‹ã‚‰ <a href="checker.html">æ‰€æŒã‚­ãƒ£ãƒ©ãƒã‚§ãƒƒã‚«ãƒ¼</a> ã§ãƒªãƒ³ã‚¯
  -->
  <style>
    :root {
      --border: #e6e6e6;
      --muted: #666;
      --bg: #fff;
      --hover: #f6f6f6;
    }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Arial, "Hiragino Sans", "Noto Sans JP", sans-serif; line-height: 1.6; margin: 24px; }
    h1 { font-size: 22px; margin: 0 0 12px; }
    .toolbar { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin-bottom: 14px; }
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ: æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®å¹…ã‚’èª¿æ•´ */
    input[type="text"], select { 
        padding: 8px; 
        min-width: 150px; /* æœ€å°å¹…ã‚’å°‘ã—ç‹­ã */
        flex-grow: 1; /* æŸ”è»Ÿã«å¹…ã‚’åºƒã’ã‚‹ */
        max-width: 300px;
        border: 1px solid #ccc; 
        border-radius: 8px; 
        background: #fff; 
    }
    button { padding: 8px 12px; border: 1px solid #ccc; background: var(--bg); border-radius: 10px; cursor: pointer; }
    button:hover { background: var(--hover); }
    .count { 
        margin-left: auto; 
        font-weight: bold; 
        padding: 8px 0; /* é…ç½®èª¿æ•´ */
    }

    .grid {
        display: grid;
        gap: 10px;
        /* æ—¢å®šã¯3åˆ— */
        grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    /* ç”»é¢å¹…ãŒä¸­ãã‚‰ã„ã®ã¨ãã¯2åˆ— */
    @media (max-width: 1024px) {
        .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    /* ã‚¹ãƒãƒ›ç­‰ã®ç‹­ã„ç”»é¢ã§ã¯1åˆ— */
    @media (max-width: 640px) {
        .grid { grid-template-columns: 1fr; }
    }
    
    .card { 
        border: 1px solid var(--border); 
        border-radius: 12px; 
        padding: 10px; 
        /* ã‚«ãƒ¼ãƒ‰å†…éƒ¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯ç¶­æŒ */
        display: grid; 
        grid-template-columns: 44px 1fr; 
        gap: 10px; 
        align-items: center; 
        background: #fff; 
    }
    .card picture, .card img { width: 44px; height: 44px; border-radius: 8px; object-fit: cover; background: #fafafa; border: 1px solid var(--border); }
    .title { display: flex; align-items: center; gap: 6px; }
    .muted { color: var(--muted); font-size: 12px; }
    .badge { font-size: 12px; padding: 2px 6px; border: 1px solid #ddd; border-radius: 999px; background: #fafafa; }
    .row { display: flex; align-items: center; gap: 8px; }
    .row input[type="checkbox"] { transform: scale(1.2); }

    details { margin-top: 16px; }
    textarea { width: 100%; min-height: 120px; padding: 10px; border: 1px solid #ccc; border-radius: 10px; }
    .footer { margin-top: 16px; font-size: 12px; color: var(--muted); }

    /* ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆalert()ã®ä»£æ›¿ï¼‰ã®ãŸã‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #customAlert {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ã‚’é€éã•ã›ã‚‹ */
    }
    .visible {
        opacity: 1 !important;
    }

  </style>
</head>
<body>
  <h1>æ˜Ÿå°ã‚­ãƒ£ãƒ©ãƒã‚§ãƒƒã‚«ãƒ¼</h1>

  <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
  <div class="toolbar">
    <input id="q" type="text" placeholder="ã‚­ãƒ£ãƒ©åã§æ¤œç´¢ï¼ˆä¾‹ï¼šã‚¢ãƒ«ãƒ‰ï¼‰" />
    <select id="rarity">
      <option value="">ã™ã¹ã¦ã®ãƒ¬ã‚¢ãƒªãƒ†ã‚£</option>
      <option value="5">â˜…5</option>
    </select>
    <!-- â–¼ ã‚¿ã‚°çµã‚Šè¾¼ã¿æ©Ÿèƒ½ã®è¿½åŠ  -->
    <select id="tagFilter">
        <!-- JSã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å‹•çš„ã«ç”Ÿæˆã—ã¾ã™ -->
    </select>
    <!-- â–² ã‚¿ã‚°çµã‚Šè¾¼ã¿æ©Ÿèƒ½ã®è¿½åŠ  -->
    
    <label class="row"><input id="ownedOnly" type="checkbox"> æ‰€æŒã®ã¿è¡¨ç¤º</label>
    <button id="checkAll">å…¨ã¦æ‰€æŒã«ã™ã‚‹</button>
    <button id="clearAll">å…¨ã¦æœªæ‰€æŒã«ã™ã‚‹</button>
    <span class="count" id="count">æ‰€æŒ 0 / 0</span>
  </div>

  <!-- ä¸€è¦§ -->
  <div class="grid" id="list"></div>

  <!-- ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ï¼èª­ã¿è¾¼ã¿ -->
  <details>
    <summary>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å…±æœ‰ï¼ˆJSONã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼‰</summary>
    <div style="margin:10px 0">
      <button id="exportBtn">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆã‚³ãƒ”ãƒ¼ï¼‰</button>
      <button id="importBtn">ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆä¸‹ã®æ¬„ã‹ã‚‰ï¼‰</button>
    </div>
    <textarea id="io" placeholder="ã“ã“ã«è²¼ã‚Šä»˜ã‘ï¼ã“ã“ã‹ã‚‰ã‚³ãƒ”ãƒ¼"></textarea>
    <p class="muted">ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼ˆlocalStorageï¼‰ã‚’ä½¿ã„ã¾ã™ã€‚åŒã˜PCãƒ»åŒã˜ãƒ–ãƒ©ã‚¦ã‚¶ã§ä¿æŒã•ã‚Œã¾ã™ã€‚</p>
  </details>

  <div class="footer">Tips: æ–‡å­—å…¥åŠ›ã§å³ãƒ•ã‚£ãƒ«ã‚¿ï¼ãƒã‚§ãƒƒã‚¯ã¯è‡ªå‹•ä¿å­˜ï¼ç”»åƒã¯ ./images ã«é…ç½®ã—ã¦ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</div>
    
  <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤ºé ˜åŸŸ -->
  <div id="customAlert" aria-live="polite"></div>

<script>
/* ========================
   1) ã‚­ãƒ£ãƒ©ä¸€è¦§ï¼ˆå¿…è¦ã«å¿œã˜ã¦è¿½åŠ ï¼‰
   - name: è¡¨ç¤ºå
   - rarity: æ•°å€¤ï¼ˆ5/4/3ï¼‰
   - tag: ä»»æ„ã®åˆ†é¡
   - img: ç”»åƒãƒ‘ã‚¹ or çµ¶å¯¾URL
   ======================== */
const CHARACTERS = [
  { name: "ã‚¢ãƒ«ãƒ‰",                          rarity: 5, tag: "å‰£/ğŸ”´",   img: "" },
  { name: "ã‚µã‚¤ãƒ©ã‚¹",                        rarity: 5, tag: "æ–/ğŸ”µ/ğŸ”´/ğŸŸ¡",   img: "" },
  { name: "ãƒ†ã‚£ãƒ†ã‚£",                        rarity: 5, tag: "æ‹³/ğŸŸ¡",   img: "" },
  { name: "ãƒ‘ãƒ«ãƒ†ãƒ†ã‚£ã‚ª",                    rarity: 5, tag: "å¼“/ğŸ”´",   img: "" },
  { name: "ãƒªãƒ¥ã‚¼",                         rarity: 5, tag: "æ–/ğŸ”µ",   img: "" },
  { name: "ã‚¬ãƒªã‚¢ãƒ¼ãƒ‰",                      rarity: 5, tag: "æ§/ğŸŸ¤",   img: "" },
  { name: "ãƒ˜ãƒ¬ãƒŠ",                         rarity: 5, tag: "æ–/ğŸŸ¤",   img: "" },
  { name: "ãƒ•ã‚£ãƒ¼ãƒï¼ˆASï¼‰",                  rarity: 5, tag: "æ–/âš«",   img: "" },
  { name: "è‰è–™äº¬",                         rarity: 5, tag: "æ‹³/",   img: "" },
  { name: "ãƒ†ãƒªãƒ¼",                         rarity: 5, tag: "æ‹³/",   img: "" },
  { name: "ä¸çŸ¥ç«èˆ",                        rarity: 5, tag: "æ‹³/",   img: "" },
  { name: "ã‚¯ãƒ¼ãƒ©",                          rarity: 5, tag: "æ‹³/",   img: "" },
  { name: "ãƒ©ã‚¤ã‚¶",                          rarity: 5, tag: "æ–/",   img: "" },
  { name: "ã‚¯ãƒ©ã‚¦ãƒ‡ã‚£ã‚¢",                    rarity: 5, tag: "å¼“/",   img: "" },
  { name: "ã‚¢ãƒ³ãƒšãƒ«",                        rarity: 5, tag: "æ–/",   img: "" },
  { name: "ã‚»ãƒ³ãƒ¤",                          rarity: 5, tag: "åˆ€/ğŸŸ£",   img: "" },
  { name: "ã‚¢ãƒ«ãƒ‰ï¼ˆASï¼‰",                     rarity: 5, tag: "å‰£/ğŸ”´",   img: "" },
  { name: "ã‚»ãƒ³ãƒ¤ï¼ˆAS)",                      rarity: 5, tag: "åˆ€/ğŸŸ£/ğŸ”´",   img: "" },
  { name: "ã‚®ãƒ«ãƒ‰ãƒŠ",                         rarity: 5, tag: "å‰£/ğŸ”´",   img: "" },
  { name: "ã‚»ãƒªã‚¨ã‚¹",                         rarity: 5, tag: "å¼“/",   img: "" },
  { name: "ã‚ªãƒœãƒ­",                           rarity: 5, tag: "åˆ€/",   img: "" },
  { name: "ãƒ„ã‚­ãƒ",                           rarity: 5, tag: "åˆ€/ğŸ”´",   img: "" },
  { name: "ã‚·ãƒ¥ã‚¼ãƒƒãƒˆ",                       rarity: 5, tag: "æ§/ğŸŸ¢",   img: "" },
  { name: "ã‚¦ã‚§ãƒãƒ¼ãƒ•ã‚£ã‚«",                   rarity: 5, tag: "å¼“/",   img: "" },
  { name: "ã‚¢ãƒ«ãƒï¼ˆASï¼‰",                     rarity: 5, tag: "å¼“/âšª",   img: "" },
  { name: "ãƒãƒ«ãƒªãƒ«ï¼ˆES)",                    rarity: 5, tag: "å‰£/âšª",   img: "" },
  { name: "èŠèŠ±ã®å‰£å®¢ï¼œã‚¢ã‚«ãƒï¼",              rarity: 5, tag: "åˆ€/ğŸŸ¤",   img: "" },
  { name: "ãƒ¡ãƒ«ãƒ”ãƒ”ã‚¢",                       rarity: 5, tag: "å‰£/ğŸŸ¢",   img: "" },
  { name: "ãƒ¡ãƒªãƒƒã‚µ",                         rarity: 5, tag: "åˆ€/",   img: "" },
  { name: "ã‚µã‚¶ãƒ³ã‚«",                         rarity: 5, tag: "æ–§/ğŸ”´",   img: "" },
  { name: "ã‚¤ã‚¦ã‚§ãƒ©ï¼ˆAS)",                    rarity: 5, tag: "æ§/",   img: "" },
  { name: "ãƒ†ã‚£ãƒ©ãƒŸã‚¹",                       rarity: 5, tag: "æ§/ğŸŸ¤",   img: "" },
  { name: "ãƒ’ãƒŠã‚®ã‚¯ï¼ˆAS)",                    rarity: 5, tag: "æ§Œ/",   img: "" },
  { name: "ã‚¯ãƒãƒŠãƒ¯",                         rarity: 5, tag: "æ–/",   img: "" },
  { name: "ã‚·ã‚§ãƒ³ãƒ•ã‚¡",                       rarity: 5, tag: "æ–/",   img: "" },
  { name: "ã‚¢ãƒŠãƒ™ãƒ«ï¼ˆES)",                    rarity: 5, tag: "æ§/ğŸ”´",   img: "" },
  { name: "é›»å½±ã®æ˜æ˜Ÿï¼œã‚·ã‚¨ãƒ«ï¼",              rarity: 5, tag: "æ§Œ/",   img: "" },
  { name: "ãƒ¤ã‚¯ãƒ¢ï¼ˆASï¼‰",                     rarity: 5, tag: "æ–/",   img: "" },
  { name: "ãƒãƒ„ãƒªã‚«",                         rarity: 5, tag: "æ–§/",   img: "" },
  { name: "ãƒ™ãƒ«ãƒˆãƒ©ãƒ³",                       rarity: 5, tag: "æ§/ğŸŸ¤",   img: "" },
  { name: "ã‚¸ãƒ«ãƒ•ã‚¡ãƒ‹ãƒ¼",                     rarity: 5, tag: "å‰£/ğŸ”µ",   img: "" },
  { name: "ãƒŸãƒŠãƒ«ã‚«ï¼ˆAS)",                    rarity: 5, tag: "å‰£/ğŸ”´",   img: "" },
  { name: "ãƒ¦ãƒ¼ã‚¤ãƒ³",                         rarity: 5, tag: "æ§Œ/ğŸ”´",   img: "" },
  { name: "éŸœæ™¦ã®è¨æ‰‹ï¼œãƒ¬ãƒ³ãƒªï¼",              rarity: 5, tag: "æ‹³/",   img: "" },
  { name: "ã‚¦ãƒ„ãƒãƒ©",                         rarity: 5, tag: "æ–§/",   img: "" },
  { name: "ã‚¸ãƒ«ãƒãƒ¼ï¼ˆAS)",                    rarity: 5, tag: "æ–§/",   img: "" },
  { name: "ãƒ¡ãƒªãƒŠ",                           rarity: 5, tag: "æ§Œ/ğŸ”µ",   img: "" },
  { name: "èŒ¨å‘ªã®è‰¶å¥³ï¼œã‚·ã‚§ã‚¤ãƒï¼",            rarity: 5, tag: "æ§Œ/",   img: "" },
  { name: "ãƒªãƒ³ãƒªãƒ¼ï¼ˆAS)",                    rarity: 5, tag: "æ‹³/",   img: "" },
  { name: "ã‚·ã‚°ãƒ¬ï¼ˆES)",                      rarity: 5, tag: "åˆ€/",   img: "" },
  { name: "ã‚·ã‚ªãƒ³",                           rarity: 5, tag: "åˆ€/ğŸ”´",   img: "" },
  { name: "ã‚»ã‚¹ã‚¿ï¼ˆAS)",                      rarity: 5, tag: "åˆ€/",   img: "" },
  { name: "çƒå¤œã®éš å¯†ï¼œãƒ„ãƒãƒ¡ï¼",              rarity: 5, tag: "æ‹³/ğŸŸ¢",   img: "" },
  { name: "ãƒ«ãƒ¼ãƒ•ã‚¹ï¼ˆAS)",                    rarity: 5, tag: "æ‹³/",   img: "" },
  { name: "ã‚·ã‚§ã‚¤ãƒ",                         rarity: 5, tag: "å‰£/ğŸ”µ",   img: "" },
  { name: "ã‚¤ãƒ…ãƒŠ",                           rarity: 5, tag: "æ–/ğŸŸ¡",   img: "" },
  { name: "ãƒã‚¤ãƒ†ã‚£",                         rarity: 5, tag: "æ–/ğŸ”µ",   img: "" },
  { name: "ã‚¤ãƒ‰",                             rarity: 5, tag: "æ‹³/",   img: "" },
  { name: "ã‚¨ãƒ«ã‚·ãƒ¼ãƒ«ï¼ˆAS)",                   rarity: 5, tag: "å‰£/ğŸ”µ",   img: "" },
  { name: "ãƒ¦ãƒŠ",                             rarity: 5, tag: "æ–/âš«",   img: "" },
  { name: "ã­ã“ã“ï¼ˆES)",                      rarity: 5, tag: "å¼“/",   img: "" },
  { name: "å¯‚å¯ã®èˆå°äººï¼œãƒ­ã‚­ãƒ‰ï¼",            rarity: 5, tag: "å‰£/",   img: "" },
  { name: "ã‚«ã‚°ãƒ©ãƒ¡",                         rarity: 5, tag: "æ§Œ/",   img: "" },
  { name: "ã‚¨ãƒ´ã‚¡",                           rarity: 5, tag: "æ–/ğŸ”µ/âšª",   img: "" },
  { name: "ã‚¯ãƒ¬ãƒ«ãƒ´ã‚©ï¼ˆAS)",                  rarity: 5, tag: "æ–/",   img: "" },
  { name: "ãƒãƒãƒ«ãƒ‰",                        rarity: 5, tag: "æ–/",   img: "" },
  { name: "ãƒˆã‚¥ãƒ¼ãƒ´ã‚¡",                      rarity: 5, tag: "æ–/ğŸŸ¤",       img: "" },
  { name: "æ°·å¡µã®æ­Œå§«ï¼œãƒ¦ã‚­ãƒï¼",             rarity: 5, tag: "å¼“/ğŸ”µ",   img: "" },
  { name: "ã‚³ãƒãƒï¼ˆAS)",                     rarity: 5, tag: "æ§/",   img: "" },
  { name: "ã‚¤ã‚¹ã‚«",                          rarity: 5, tag: "åˆ€/ğŸŸ¢",   img: "" },
  { name: "å¢¨æŸ“ã®è»å¸«ï¼œã‚·ã‚ªãƒ³ï¼ï¼ˆASï¼‰",       rarity: 5, tag: "æ–/",   img: "" },
  { name: "ã‚·ã‚ªãƒ³ï¼ˆESï¼‰",                    rarity: 5, tag: "åˆ€/ğŸŸ¡",   img: "" },
  { name: "ãƒ‹ãƒ«ãƒ¤",                          rarity: 5, tag: "æ‹³/",   img: "" },
  { name: "ãƒ´ã‚§ãƒ¬ãƒƒãƒˆï¼ˆAS)",                  rarity: 5, tag: "æ§Œ/",   img: "" },
  { name: "ãƒŸãƒ¥ãƒ«ã‚¹",                        rarity: 5, tag: "æ–/ğŸŸ¤",   img: "" },
  { name: "èµ¤å¥—ã®ç‚ä½¿ã„ï¼œãƒ‡ãƒ¥ãƒ¼ã‚¤ï¼ï¼ˆAS)",     rarity: 5, tag: "æ‹³/",   img: "" },
  { name: "ç¾©ä¾ ã®çŒŸäººï¼œãƒ©ã‚¯ãƒ¬ã‚¢ï¼",            rarity: 5, tag: "å¼“/",   img: "" },
  { name: "ãƒ’ã‚¹ãƒ¡ãƒŠ",                         rarity: 5, tag: "æ§/ğŸ”µ",   img: "" },
  { name: "ãƒªãƒŠãƒªã‚¢",                         rarity: 5, tag: "å‰£/",   img: "" },
  { name: "ã‚»ãƒ†ã‚£ãƒ¼",                         rarity: 5, tag: "æ§/ğŸ”´",   img: "" },
  { name: "ãƒ¬ãƒ³ãƒª",                           rarity: 5, tag: "æ–§/ğŸ”´/âš«",   img: "" },
  { name: "ç¢§å…‰ã®éŒä½¿ã„ï¼œã‚·ãƒ¥ã‚¼ãƒƒãƒˆï¼ï¼ˆASï¼‰",   rarity: 5, tag: "æ–§/ğŸŸ¢",   img: "" },
  { name: "èŒœè¢–ã®æ—…å•†äººï¼œã‚·ã‚°ãƒ¬ï¼",            rarity: 5, tag: "å‰£/",   img: "" },
  { name: "ã‚¢ã‚«ãƒ",                           rarity: 5, tag: "åˆ€/ğŸ”´",   img: "" },
  { name: "ãƒ¬ã‚¤ãƒ´ãƒ³ï¼ˆAS)",                    rarity: 5, tag: "æ–/",   img: "" },
  { name: "ãƒãƒªã‚¨ãƒ«",                         rarity: 5, tag: "æ–/âš«",   img: "" },
  { name: "é»’è¡£ã®åˆ€ä½¿ã„ï¼œã‚¤ã‚¹ã‚«ï¼ï¼ˆAS)",       rarity: 5, tag: "åˆ€/",   img: "" },
  { name: "ãƒŸãƒ¥ãƒ«ã‚¹ï¼ˆES)",                    rarity: 5, tag: "æ–§/",   img: "" },
  { name: "ãƒ­ã‚­ãƒ‰",                           rarity: 5, tag: "æ‹³/ğŸŸ¤",       img: "" },
  { name: "ãƒ´ã‚¡ãƒ¬ã‚¹",                         rarity: 5, tag: "æ–§/",   img: "" },
  { name: "ãƒ‹ãƒŠ",                             rarity: 5, tag: "æ–/",   img: "" },
  { name: "ã‚¢ãƒŠãƒ™ãƒ«",                         rarity: 5, tag: "å‰£/ğŸ”µ",   img: "" },
  { name: "å¤¢åŸã®è©©äººï¼œãƒ‡ãƒ¥ãƒŠãƒªã‚¹ï¼ï¼ˆAS)",      rarity: 5, tag: "æ–/",   img: "" },
  { name: "ãƒ­ã‚¼ãƒƒã‚¿",                         rarity: 5, tag: "æ–/ğŸ”´",   img: "" },
];

/* ========================
   2) ä¿å­˜ã‚­ãƒ¼ã¨åˆæœŸåŒ–
   ======================== */
const KEY = "ae_owned_v1_images";
let owned = {};
try { 
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã®èª­ã¿è¾¼ã¿
    const stored = localStorage.getItem(KEY);
    if (stored) {
        owned = JSON.parse(stored);
    }
} catch (e) { 
    console.error("Error loading from localStorage:", e);
    owned = {}; // èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§åˆæœŸåŒ–
}

/* ========================
   3) DOMè¦ç´ å‚ç…§
   ======================== */
const $list = document.getElementById("list");
const $q = document.getElementById("q");
const $rarity = document.getElementById("rarity");
const $tagFilter = document.getElementById("tagFilter"); 
const $ownedOnly = document.getElementById("ownedOnly");
const $count = document.getElementById("count");
const $io = document.getElementById("io");
const $customAlert = document.getElementById("customAlert");

/* ========================
    ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆé–¢æ•° (alert()ã®ä»£æ›¿)
    ======================== */
function showCustomAlert(message) {
    $customAlert.textContent = message;
    $customAlert.classList.add('visible');
    setTimeout(() => {
        $customAlert.classList.remove('visible');
    }, 2000); // 2ç§’å¾Œã«æ¶ˆãˆã‚‹
}

/* ========================
    4-1) ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å‹•çš„ç”Ÿæˆ
    ======================== */
function populateTagFilter() {
    const allTags = new Set();
    CHARACTERS.forEach(ch => {
        if (ch.tag) {
            // ä¾‹: "æ–/ãƒ’ãƒ¼ãƒ©ãƒ¼"ã‚’"æ–"ã¨"ãƒ’ãƒ¼ãƒ©ãƒ¼"ã«åˆ†å‰²ã—ã¦ç™»éŒ²
            ch.tag.split('/').forEach(tag => allTags.add(tag.trim()));
        }
    });

    // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
    $tagFilter.innerHTML = '';

    // ã€Œã™ã¹ã¦ã®ã‚¿ã‚°ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
    const defaultOption = document.createElement("option");
    defaultOption.value = "";
    defaultOption.textContent = "ã™ã¹ã¦ã®ã‚¿ã‚°";
    $tagFilter.appendChild(defaultOption);

    // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚¿ã‚°ã‚’ã‚½ãƒ¼ãƒˆã—ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«è¿½åŠ 
    Array.from(allTags).sort().forEach(tag => {
        const option = document.createElement("option");
        option.value = tag;
        option.textContent = tag;
        $tagFilter.appendChild(option);
    });
}


/* ========================
   4-2) ã‚«ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆç”»åƒå¯¾å¿œï¼‰
   ======================== */
function createCard(ch) {
  const wrap = document.createElement("label");
  wrap.className = "card";
  wrap.dataset.name = ch.name;
  wrap.dataset.rarity = String(ch.rarity);
  wrap.dataset.tag = ch.tag || ""; // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ä½¿ã†ãŸã‚ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¨ã—ã¦ä¿æŒ

  // ç”»åƒï¼ˆonerror ã§éè¡¨ç¤ºã«ã—ã¦å´©ã‚Œå¯¾ç­–ï¼‰
  const pic = document.createElement("picture");
  const img = document.createElement("img");
  img.alt = ch.name;
  if (ch.img) img.src = ch.img;
  // ç”»åƒãŒèª­ã¿è¾¼ã‚ãªã‹ã£ãŸå ´åˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç”»åƒã‚’é…ç½®ã—ã¦ã„ãªã„å ´åˆãªã©ï¼‰ã®å‡¦ç†
  img.onerror = () => { img.src = `https://placehold.co/44x44/cccccc/333333?text=${ch.name[0]}`; }; 
  pic.appendChild(img);

  // ãƒ†ã‚­ã‚¹ãƒˆ & ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
  const right = document.createElement("div");
  const row1 = document.createElement("div");
  row1.className = "row";

  const cb = document.createElement("input");
  cb.type = "checkbox";
  cb.checked = !!owned[ch.name];
  cb.addEventListener("change", () => {
    owned[ch.name] = cb.checked;
    localStorage.setItem(KEY, JSON.stringify(owned));
    updateCount();
    applyFilter(); // æ‰€æŒãƒ»æœªæ‰€æŒã§è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ãƒ•ã‚£ãƒ«ã‚¿ã‚’å†é©ç”¨
  });

  const title = document.createElement("div");
  title.className = "title";
  title.innerHTML = `<strong>${ch.name}</strong>`;

  row1.appendChild(cb);
  row1.appendChild(title);

  const row2 = document.createElement("div");
  row2.className = "muted";
  
    // ã‚¿ã‚°ã‚’ "/" ã§åˆ†å‰²ã—ã¦è¤‡æ•°ã®ãƒãƒƒã‚¸ã‚’è¡¨ç¤º
    let tagHtml = "";
    if (ch.tag) {
        ch.tag.split('/').forEach(tag => {
            tagHtml += `<span class="badge">${tag.trim()}</span> `;
        });
    } else {
        tagHtml = `<span class="badge">-</span>`;
    }
    row2.innerHTML = `â˜…${ch.rarity} ${tagHtml}`;

  right.appendChild(row1);
  right.appendChild(row2);

  wrap.appendChild(pic);
  wrap.appendChild(right);
  return wrap;
}

/* ========================
   5) æç”»ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ»ã‚«ã‚¦ãƒ³ãƒˆ
   ======================== */
function render() {
  $list.innerHTML = "";
  CHARACTERS.forEach(ch => $list.appendChild(createCard(ch)));
  // ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’æœ€åˆã«ç”Ÿæˆ
  populateTagFilter(); 
  updateCount();
  applyFilter();
}

function updateCount() {
  const total = CHARACTERS.length;
  const have = Object.keys(owned).filter(name => owned[name]).length;
  $count.textContent = `æ‰€æŒ ${have} / ${total}`;
}

function applyFilter() {
  const q = $q.value.trim().toLowerCase();
  const r = $rarity.value;
  // â–¼ ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å€¤ã‚’å–å¾—
  const t = $tagFilter.value;
  // â–²
  const ownOnly = $ownedOnly.checked;

  [...$list.children].forEach(card => {
    const name = card.dataset.name.toLowerCase();
    const rar = card.dataset.rarity;
    const tags = card.dataset.tag.toLowerCase(); // ã‚«ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‹ã‚‰ã‚¿ã‚°ã‚’å–å¾—
    const has = !!owned[card.dataset.name]; 

    let show = true;
    if (q && !name.includes(q)) show = false;
    if (r && r !== rar) show = false;
    // â–¼ ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ 
    if (t && !tags.includes(t.toLowerCase())) show = false; 
    // â–²
    if (ownOnly && !has) show = false;
    
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¼´ã£ã¦è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
    if (show) {
        card.style.display = "";
        setTimeout(() => card.style.opacity = 1, 10);
    } else {
        card.style.opacity = 0;
        setTimeout(() => card.style.display = "none", 300);
    }
  });
}

/* ========================
   6) ã‚¤ãƒ™ãƒ³ãƒˆ
   ======================== */
$q.addEventListener("input", applyFilter);
$rarity.addEventListener("change", applyFilter);
// â–¼ ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
$tagFilter.addEventListener("change", applyFilter);
// â–²
$ownedOnly.addEventListener("change", applyFilter);

document.getElementById("checkAll").addEventListener("click", () => {
  CHARACTERS.forEach(ch => owned[ch.name] = true);
  localStorage.setItem(KEY, JSON.stringify(owned));
  render();
  showCustomAlert("å…¨ã¦æ‰€æŒã«ã—ã¾ã—ãŸï¼");
});

document.getElementById("clearAll").addEventListener("click", () => {
  CHARACTERS.forEach(ch => owned[ch.name] = false);
  localStorage.setItem(KEY, JSON.stringify(owned));
  render();
  showCustomAlert("å…¨ã¦æœªæ‰€æŒã«ã—ã¾ã—ãŸã€‚");
});

/* ========================
   7) ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
   ======================== */

document.getElementById("exportBtn").addEventListener("click", () => {
  const data = JSON.stringify(owned);
  $io.value = data;
  $io.select();
  try {
    document.execCommand("copy");
    showCustomAlert("ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
  } catch (err) {
    console.error("Copy error:", err);
    showCustomAlert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‹ã‚‰æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚");
  }
});


document.getElementById("importBtn").addEventListener("click", () => {
  try {
    const data = JSON.parse($io.value.trim() || "{}");
    // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ç°¡å˜ãªæ¤œè¨¼
    if (typeof data !== 'object' || Array.isArray(data)) {
        throw new Error("Invalid JSON structure");
    }

    owned = data;
    localStorage.setItem(KEY, JSON.stringify(owned));
    render();
    showCustomAlert("æ‰€æŒãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼");
  } catch (e) {
    console.error("Import error:", e);
    showCustomAlert("ã‚¨ãƒ©ãƒ¼: JSONã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“");
  }
});

/* åˆæœŸæç”» */
render();
</script>
</body>
</html>
